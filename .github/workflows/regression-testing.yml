name: Regression Testing

on: [push]
  # schedule:
    # - cron: 0 0 * * *

jobs:
  test:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ ubuntu-latest, macos-latest, windows-latest ]
        python-version: [ "3.6", "3.7", "3.8", "3.9" ]
        include:
          - os: ubuntu-latest
            shell: bash
            script: scripts/unix.sh
          - os: macos-latest
            shell: bash
            script: tests/regressions/unix.sh
          - os: windows-latest
            shell: pwsh
            script: tests/regressions/windows.bat

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install dependencies
        run: pip install -r requirements.txt

#      - name: Run normal tests
#        run: pytest -rs
#        env:
#          QC_USER_ID: ${{ secrets.QC_USER_ID }}
#          QC_API_TOKEN: ${{ secrets.QC_API_TOKEN }}

      - name: Run regression tests
        run: ${{ matrix.script }}
        shell: ${{ matrix.shell }}
